dnl Process this file with autoconf to produce configure.

AC_INIT(src/sdl.c)
AM_INIT_AUTOMAKE("guile-sdl", "0.1.7")
AM_MAINTAINER_MODE

CFLAGS="-Wall -pedantic -ansi"

AC_DEFUN([GUILE_FLAGS],[
## The GUILE_FLAGS macro.
  ## First, let's just see if we can find Guile at all.
  AC_MSG_CHECKING(for Guile)
  guile-config link > /dev/null || {
    echo "configure: cannot find guile-config; is Guile installed?" 1>&2
    exit 1
  }
  GUILE_CFLAGS="`guile-config compile`"
  GUILE_LDFLAGS="`guile-config link`"
  AC_SUBST(GUILE_CFLAGS)
  AC_SUBST(GUILE_LDFLAGS)
  AC_MSG_RESULT(yes)
])

GUILE_FLAGS
if test "`guile -c '(display (string>=? (version) "1.5.0"))'`" != "#t"; then
  AC_MSG_ERROR([Your Guile is too old.  You need CVS Guile January 2001 or later.])
fi

dnl Figure out which math library to use - taken from SDL_gfxPrimitives
case "$target" in
    *-*-cygwin* | *-*-mingw32*)
        MATHLIB=""
        ;;
    *-*-beos*)
        MATHLIB=""
        ;;
    *-*-darwin*)
        MATHLIB=""
        ;;
    *-*-aix*)
	if test x$ac_cv_prog_gcc = xyes; then
     	    CFLAGS="-mthreads"
	fi
        ;;
    alpha*-*-linux*)
    	CFLAGS="$CFLAGS -mcpu=ev4 -Wa,-mall"
	;;
    *)
        MATHLIB="-lm"
        ;;
esac
AC_SUBST(MATHLIB)

dnl Check for SDL
SDL_VERSION=1.2.0
AM_PATH_SDL($SDL_VERSION,
            :,
            AC_MSG_ERROR([*** SDL version $SDL_VERSION not found!])
)

CFLAGS="$CFLAGS $SDL_CFLAGS"
LIBS="$LIBS $SDL_LIBS"

dnl Checks for libraries.
dnl MUST have SDL_image
AC_CHECK_LIB(SDL_image, IMG_Load,
 	     LIBS="$LIBS -lSDL_image",
 	     AC_MSG_ERROR([*** SDL_image library not found!])	
 	    )

dnl SDL_mixer is optional
have_mixer=yes
AC_ARG_ENABLE(mixer,
[  --enable-mixer          Provide bindings for SDL_mixer [default=yes]],
	       , enable_mixer=yes)

if test x$enable_mixer = xyes; then	

	AC_CHECK_LIB(SDL_mixer, Mix_OpenAudio,
		     LIBS="$LIBS -lSDL_mixer",
	     	     have_mixer=no
	    	     )	
	AM_CONDITIONAL(HAVE_MIXER, test x$have_mixer = xyes)
fi

dnl SDL_ttf is optional
have_ttf=yes
AC_ARG_ENABLE(ttf,
[  --enable-ttf          Provide bindings for SDL_ttf [default=yes]],
	       , enable_ttf=yes)

if test x$enable_ttf = xyes; then	

	AC_CHECK_LIB(SDL_ttf, TTF_Init,
		     LIBS="$LIBS -lSDL_ttf",
	     	     have_ttf=no
	    	     )	
	AM_CONDITIONAL(HAVE_TTF, test x$have_ttf = xyes)
fi

AC_PROG_CC
AC_PROG_CPP
AC_PROG_INSTALL
AC_PROG_LN_S
AC_PROG_MAKE_SET
AC_PROG_RANLIB
AM_PROG_LIBTOOL

AC_OUTPUT([
Makefile
src/Makefile
src/SDL_rotozoom/Makefile
sdl/Makefile
sdl-mixer/Makefile
sdl-ttf/Makefile
sdl-gfx/Makefile
sdl-gfx/SDL_gfxPrimitives/Makefile
doc/Makefile
])
