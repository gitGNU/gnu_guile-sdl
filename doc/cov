#!/bin/sh
# usage: cov
# env vars required: srcdir

set -e

test -n "${srcdir}"

sed -e '/GH_DEFPROC/!d' \
    -e 's/^[^"]*"//g' \
    -e 's/".*//g' \
    ${srcdir}/../*/*.c \
    | sort \
    | uniq \
    > TMP1

sed -e '/twerpdoc/!d' \
    -e 's/.*(//g;s/).*//g' \
    -e '/^event:/d' \
    -e '/^surface:/d' \
    -e '/^color:/d' \
    ${srcdir}/*.twerp \
    | sort \
    | uniq \
    > TMP2

diff -u TMP1 TMP2 > TMP

if [ -s TMP ] ; then
    echo 'ERROR: bad doc coverage!'
    echo '       here is a list:'
    cat TMP
    rm TMP1 TMP 2TMP
    exit 1
fi

rm TMP1 TMP2 TMP
exit 0

# cov ends here
