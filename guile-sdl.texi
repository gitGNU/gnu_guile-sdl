\input texinfo
@c -*-texinfo-*-
@c %**start of header
@setfilename guile-sdl.info
@settitle guile-sdl
@iftex
@afourpaper
@end iftex
@c %**end of header

@set UPDATED 17 Jun 2001
@set EDITION 0.1.0
@set VERSION 0.1.0

@dircategory Guile
@direntry
* guile-sdl: (guile-sdl).     SDL for Guile
@end direntry


@c --- title page starts here ---

@titlepage
@title guile-sdl
@subtitle SDL for Guile
@subtitle Version @value{VERSION}
@author Alex Shinn

@c  The following two commands
@c  start the copyright page.
@page
@vskip 0pt plus 1filll
Copyright @copyright{} 2001 Alex Shinn

Permission is granted to make and distribute verbatim copies of
this manual provided the copyright notice and this permission notice
are preserved on all copies.
@end titlepage

@c --- title page ends here ---

@syncodeindex vr cp
@syncodeindex fn cp

@node Top, Introduction, (dir), (dir)

@ifinfo
This file documents the guile-sdl library, which is a generic
sdl for Guile.
@end ifinfo

@menu
* Introduction::                What is this all about?
* General SDL::                 General SDL functions
* Video::                       Video and Graphics Functions
* Events::                      Events and Input Handling
* OpenGL::                      OpenGL Interface
* TrueType::                    TrueType Font Support
* Audio::                       Audio Support
* Index::                       Procedure index.
@end menu

@node Introduction, General SDL, Top, Top
@chapter Introduction

The guile-sdl library is an interface to the SDL (Simple Direct Media
Layer) library.  The goal is to provide both a clean and direct
interface to the lowest level SDL, while extending with higher level
concepts where useful, such as default arguments and functional-style
application of graphics routines.  Several SDL add-on libraries have
been wrapped and included with guile-sdl, including SDL_image (for
loading multiple image formats), SDL_ttf (for rendering true type
fonts), and SDL_mixer (for playing/mixing different audio formats).
In addition, some low-level 2D graphics primitives for scaling and
rotations have been provided.

OpenGL is supported, but requires the guile-opengl library, which is
currently in a very early alpha state.

@menu
* Quick Start::                A simple example
* Naming Conventions::         Naming conventions
@end menu

@node Quick Start, , Naming Conventions, Introduction
@section Quick Start

To whet your appetite, and hopefully get you excited about the ease
and flexibility of programming with guile-sdl, we begin with a simple
example.  The following program, which can be found in the examples
directory, is a simple image browser.  You can cycle through images by
using space, n or right to go forward, backspace, p or left to go
backwards, and escape or q to quit.

@lisp
;; use the SDL module (prefixing symbols with "sdl-")
(use-modules ((sdl sdl)
              :rename (symbol-prefix-proc 'sdl-)))

;; srfi-1 for list processing and srfi-2 for and-let*
(use-modules (srfi srfi-1)
             (srfi srfi-2))

;; initialize the video subsystem
(init-sdl init/video)

;; directory to search for images in
(define image-dir "/usr/share/pixmaps/")

;; utility to test if a path is a directory
(define (file? f)
  (let* ((stats (stat f))
         (type (stat:type stats)))
    (eq? type 'regular)))

;; build a ring of image file names
(define image-ring
  (let ((dir (opendir image-dir)))
    (letrec ((D (lambda (ls)
                  (let ((file (readdir dir)))
                    (if (eof-object? file)
                        (begin (closedir dir) ls)
                        (D (cons (string-append image-dir file)
                                 ls)))))))
      (apply circular-list (reverse (filter file? (D '())))))))

;; functions to cycle through the ring
(define (next-image)
  (let ((next (car image-ring)))
    (set! image-ring (cdr image-ring))
    next))

(define (prev-image)
  (let ((orig image-ring))
    (while (not (eq? (cddr image-ring) orig))
      (set! image-ring (cdr image-ring)))
    (let ((image (car image-ring)))
      (set! image-ring (cdr image-ring))
      image)))

;; display an image given a filename
(define (show file)
  (and-let* ((image (load-image file)))
    (set-video-mode (surface:w image) (surface:h image)
                    24 video/hwsurface)
    (blit-surface image)
    (flip)))

;; show the first image
(show (next-image))

;; event handler
(let handle ((e (make-event)))
  (if (wait-event e)
    (case (event:type e)
      ((event/key-down)
       (case (event:key:keysym:sym e)
         ((key/left key/backspace key/p)
          (show (prev-image)))
         ((key/right key/space key/n)
          (show (next-image)))
         ((key/escape key/q)
          (quit-sdl)
          (quit))))
      (else
        (handle e))))
    (handle e))
@end lisp

@node Naming Conventions, Quick Start, , Introduction
@section Naming Conventions

@menu
* Renaming C Functions::        How SDL C Functions are named in Guile
* Enums and Constants::         Naming enumerated types
* Create and Make::             Create vs Make Functions
@end menu

The most important thing to learning a wrapped library for a
programming language, assuming you know the language and the library,
is to know the naming conventions.  Then you can begin programming
without having to look up the exact function reference for the wrapper
library.

@node Renaming C Functions, Enums and Constants, , Naming Conventions
@subsection Renaming C Functions

As with standard guile naming conventions, all names are converted to
lower-case, and underscores are replaced with hyphens.  By default the
@code{SDL_} prefix is removed, though you may wish to import with an
@code{sdl-} prefix renamer.  To avoid conflicting with the standard
@code{quit} procedure, @code{SDL_quit} is renamed @code{quit-sdl}, and
@code{SDL_init} is renamed @code{init-sdl} for symmetry.

@node Enums and Constants, Create and Make, Renaming C Functions, Naming Conventions
@subsection Enums and Constants

SDL flags and numeric constants are denoted with a @code{type/}
prefix.  So for instance, the @code{SDL_INIT_FOO} constants are
renamed @code{init/foo}.  In a few instances a type prefix has been
introduced where one did not previously exist, to more clearly
indicate the symbol as a constant and document its intent.

The enumerated types for event types and key symbols are translated as
symbols, for ease of use in @code{case} statements.  This is not done
for other constants, which are typically flags that need to be joined
with @code{logior}.

@node Create and Make, , Enums and Constants, Naming Conventions
@subsection Create and Make

The standard SDL prefix for creating a new instance of a type is
@code{create}.  The standard Guile prefix is @code{make}.  Wherever an
SDL function uses the @code{create} prefix we will keep it.  SMOB
creation functions unique to Guile, such as @code{make-rect}, will use
@code{make} as a prefix.  In addition, we will sometimes introduce
higher-level creation functions, such as @code{make-surface}, which is
a wrapper to @code{create-rgb-surface} which provides useful default
values from the current screen information.

@node General SDL, Video, Introduction, Top
@chapter General SDL

@node Video, Events, General SDL, Top
@chapter Video

@node Events, OpenGL, Video, Top
@chapter Events

@node OpenGL, TrueType, Events, Top
@chapter OpenGL

@node TrueType, Audio, OpenGL, Top
@chapter TrueType

@node Audio, Index, TrueType, Top
@chapter Audio

@node Index,  , Audio, Top
@comment    node-name,         next,       previous, up
@unnumbered Index
     
@printindex cp

@contents

@bye
